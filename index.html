<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CETAK SLIP VA SMARTCARD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icon Library (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter untuk UI, Calibri Import untuk Cetak -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2224%22 height=%2224%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%234F46E5%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2%22/><path d=%22M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6%22/><rect x=%226%22 y=%2214%22 width=%2212%22 height=%228%22 rx=%221%22/></svg>">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap');

        /* --- GLOBAL UI STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Pattern Background untuk Preview Area */
        .bg-grid-pattern {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Animasi Masuk Kartu */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.9) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-pop-in {
            animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* --- PRINT SPECIFIC STYLES (DO NOT CHANGE) --- */
        /* Styling khusus area kertas A4 */
        .page-a4 {
            width: 210mm;
            min-height: 297mm;
            padding: 10mm;
            background: white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            box-sizing: border-box;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Styling Kartu Slip - FIXED 6cm x 2cm */
        .slip-card {
            width: 60mm;  
            height: 20mm; 
            font-family: 'Calibri', 'Arial', sans-serif; /* Font Cetak Tetap Calibri */
            font-size: 11.5pt;
            line-height: 1;
            border: 1px solid black;
            background: white;
            box-sizing: border-box;
            break-inside: avoid;
            display: flex;
            flex-direction: column;
            color: black;
            cursor: default;
        }

        .slip-row {
            height: 5mm; 
            flex: 1; 
            overflow: hidden;
            display: flex;
            align-items: center;
            border-bottom: 1px solid black;
            padding: 0 2px;
            white-space: nowrap;
        }

        .slip-row:last-child {
            border-bottom: none;
        }

        .label-col { width: 75px; flex-shrink: 0; }
        .separator-col { width: 8px; flex-shrink: 0; text-align: left; }
        .content-col { flex: 1; overflow: hidden; text-overflow: ellipsis; }

        /* Delete Button Style */
        .btn-delete {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .slip-card:hover .btn-delete {
            opacity: 1;
            transform: scale(1);
        }

        /* --- MEDIA PRINT --- */
        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }
            body {
                background: white;
                -webkit-print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .page-a4 {
                width: 100%;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            .slip-card {
                break-inside: avoid;
                page-break-inside: avoid;
                border: 1px solid black !important;
            }
            .btn-delete {
                display: none;
            }
        }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen overflow-hidden">

    <!-- TOAST NOTIFICATION CONTAINER -->
    <div id="toastContainer" class="fixed top-5 right-5 z-[100] flex flex-col gap-2 pointer-events-none"></div>

    <!-- SIDEBAR (CONTROL PANEL) -->
    <div class="w-full md:w-[400px] bg-white border-r border-slate-200 flex flex-col no-print shadow-[4px_0_24px_rgba(0,0,0,0.02)] z-20">
        
        <!-- Header Sidebar -->
        <div class="p-6 border-b border-slate-100 bg-white">
            <div class="flex items-center gap-3 mb-1">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                    <i data-lucide="printer" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">SMART SLIP</h1>
                    <p class="text-xs font-medium text-slate-400">CETAK SLIP VA SMARTCARD</p>
                </div>
            </div>
        </div>

        <!-- Scrollable Form Area -->
        <div class="flex-1 overflow-y-auto p-6 space-y-6">
            
            <!-- Input Card -->
            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200 space-y-4 shadow-sm">
                <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2">
                    <i data-lucide="pen-tool" class="w-4 h-4"></i> Data Input
                </h2>
                
                <div class="space-y-1">
                    <label class="text-xs font-medium text-slate-600 ml-1">Nama Santri</label>
                    <div class="relative group">
                        <i data-lucide="user" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                        <input type="text" id="inputNama" placeholder="KOSONG UNTUK BLANGKO" 
                            class="w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all uppercase font-medium text-slate-700 placeholder:text-slate-300">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-slate-600 ml-1">Nomor VA</label>
                    <div class="relative group">
                        <i data-lucide="credit-card" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                        <input type="text" id="inputVa" value="900-2270-0002" 
                            class="w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all font-mono text-slate-700">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-medium text-slate-600 ml-1">Jumlah Copy</label>
                    <div class="flex items-center gap-2 bg-white border border-slate-200 rounded-lg p-1">
                        <button onclick="adjustCount(-1)" class="w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 text-slate-500 transition-colors">
                            <i data-lucide="minus" class="w-4 h-4"></i>
                        </button>
                        <input type="number" id="inputJumlah" min="1" value="1" 
                            class="flex-1 text-center font-bold text-slate-700 focus:outline-none text-sm h-8" onchange="validateCount(this)">
                        <button onclick="adjustCount(1)" class="w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 text-slate-500 transition-colors">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <button onclick="addCards()" 
                    class="w-full bg-slate-900 hover:bg-slate-800 text-white py-2.5 rounded-xl text-sm font-semibold shadow-lg shadow-slate-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2 mt-2">
                    <i data-lucide="plus-circle" class="w-4 h-4"></i>
                    Generate Slip
                </button>
            </div>

            <!-- Stats & Tips -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <p class="text-xs text-blue-600 font-medium mb-1">Total Slip</p>
                    <p id="totalCountDisplay" class="text-2xl font-bold text-blue-700">0</p>
                </div>
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100">
                    <p class="text-xs text-emerald-600 font-medium mb-1">Kertas</p>
                    <p class="text-2xl font-bold text-emerald-700">A4</p>
                </div>
            </div>
            
            <div class="bg-amber-50 rounded-lg p-3 border border-amber-100 flex gap-3">
                <i data-lucide="info" class="w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"></i>
                <p class="text-xs text-amber-700 leading-relaxed">
                    Mode cetak menggunakan ukuran <strong>2cm x 6cm</strong>. Pastikan scale printer 100% saat mencetak.
                </p>
            </div>

        </div>

        <!-- Footer Sidebar -->
        <div class="p-6 border-t border-slate-100 bg-white space-y-3">
            <button onclick="clearAll()" class="w-full py-2 text-xs font-medium text-red-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center justify-center gap-1">
                <i data-lucide="trash-2" class="w-3 h-3"></i> Reset Data
            </button>
            <button onclick="window.print()" 
                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white py-3.5 rounded-xl shadow-lg shadow-blue-500/30 active:scale-[0.98] transition-all font-semibold flex items-center justify-center gap-2 text-sm tracking-wide">
                <i data-lucide="printer" class="w-5 h-5"></i>
                CETAK SEKARANG
            </button>
        </div>
    </div>

    <!-- MAIN PREVIEW AREA -->
    <div class="flex-1 bg-slate-100 bg-grid-pattern overflow-auto relative flex flex-col items-center">
        
        <!-- Top Toolbar -->
        <div class="sticky top-0 w-full bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 py-3 flex justify-between items-center z-10 no-print">
            <div class="text-xs font-medium text-slate-500">
                Preview Mode <span class="mx-2">â€¢</span> A4 Size (210 x 297 mm)
            </div>
            <div class="flex gap-2">
                <div class="text-[10px] px-2 py-1 bg-slate-200 rounded text-slate-600 font-mono">Zoom: 100%</div>
            </div>
        </div>

        <!-- Canvas Wrapper (Centered) -->
        <div class="py-10 px-4 min-w-min">
            <div id="printArea" class="page-a4 group">
                
                <!-- Grid Container: GAP 1mm (Mepet) -->
                <div id="cardContainer" class="flex flex-wrap content-start" style="gap: 1mm;">
                    <!-- Cards injected via JS -->
                </div>

                <!-- Empty State Illustration -->
                <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center text-slate-300">
                    <div class="w-24 h-24 bg-slate-50 rounded-full flex items-center justify-center mb-4 border border-slate-100 shadow-sm">
                        <i data-lucide="layout-template" class="w-10 h-10 text-slate-300"></i>
                    </div>
                    <p class="text-lg font-semibold text-slate-400">Area Kertas Kosong</p>
                    <p class="text-sm text-slate-400 mt-1">Tambahkan data dari panel kiri untuk melihat preview.</p>
                </div>

                <!-- Watermark for preview (hidden on print) -->
                <div class="absolute bottom-4 right-4 text-[10px] text-slate-300 font-mono no-print pointer-events-none">
                    PREVIEW ONLY - A4
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // State Awal
        let cards = [
            { id: 1, nama: 'MICHAEL', va: '900-2270-0002' },
            { id: 2, nama: '', va: '900-2270-0002' }
        ];

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', () => {
            renderCards();
            lucide.createIcons();
            
            // Input Enter Key Support
            document.getElementById('inputNama').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') addCards();
            });
        });

        // Helper: Format Angka
        function adjustCount(amount) {
            const input = document.getElementById('inputJumlah');
            let val = parseInt(input.value) || 1;
            val = Math.max(1, val + amount);
            input.value = val;
        }

        function validateCount(input) {
            if (input.value < 1) input.value = 1;
        }

        // Helper: Toast Notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const icon = type === 'error' ? 'alert-circle' : 'check-circle-2';
            const colorClass = type === 'error' ? 'bg-red-50 text-red-600 border-red-200' : 'bg-white text-slate-700 border-slate-200';
            const shadowClass = 'shadow-lg shadow-slate-200/50';

            toast.className = `flex items-center gap-3 px-4 py-3 rounded-xl border ${colorClass} ${shadowClass} animate-pop-in pointer-events-auto min-w-[200px]`;
            toast.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5 ${type === 'error' ? 'text-red-500' : 'text-green-500'}"></i>
                <span class="text-sm font-medium">${message}</span>
            `;

            container.appendChild(toast);
            lucide.createIcons({ root: toast });

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Core Render Function
        function renderCards() {
            const container = document.getElementById('cardContainer');
            const emptyState = document.getElementById('emptyState');
            const totalCountDisplay = document.getElementById('totalCountDisplay');

            // Hitung total dan update UI stats
            totalCountDisplay.innerText = cards.length;

            if (cards.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            } else {
                emptyState.style.display = 'none';
            }

            // Render ulang hanya jika perlu (Optimasi sederhana)
            // Untuk demo ini kita clear & redraw agar urutan benar
            container.innerHTML = '';

            cards.forEach((card, index) => {
                const cardHTML = `
                    <div class="slip-card group relative animate-pop-in" style="animation-delay: ${index * 0.02}s">
                        <!-- Floating Delete Button -->
                        <button onclick="deleteCard(${card.id})" 
                            class="btn-delete absolute -top-2 -right-2 bg-white text-red-500 border border-red-100 rounded-full w-5 h-5 flex items-center justify-center shadow-md z-10 hover:bg-red-500 hover:text-white cursor-pointer hover:shadow-red-200"
                            title="Hapus Slip">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>

                        <!-- Header -->
                        <div class="slip-row justify-center font-bold">SMARTCARD</div>

                        <!-- Nama -->
                        <div class="slip-row">
                            <div class="label-col">NAMA</div>
                            <div class="separator-col">:</div>
                            <div class="content-col uppercase">${card.nama}</div>
                        </div>

                        <!-- VA (Bold) -->
                        <div class="slip-row font-bold">
                            <div class="label-col">NO.REK/VA</div>
                            <div class="separator-col">:</div>
                            <div class="content-col">${card.va}</div>
                        </div>

                        <!-- Footer -->
                        <div class="slip-row" style="font-size: 11.5pt;">
                            <div style="transform-origin: left; transform: scaleX(0.9); white-space: nowrap;">
                                TRANFER DARI ATM SELAIN BSI : <span class="font-bold">451</span>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });

            lucide.createIcons();
        }

        // Logic Tambah
        function addCards() {
            const namaInput = document.getElementById('inputNama');
            const vaInput = document.getElementById('inputVa');
            const jumlahInput = document.getElementById('inputJumlah');

            const nama = namaInput.value.toUpperCase();
            const va = vaInput.value;
            const jumlah = parseInt(jumlahInput.value) || 1;

            if (!va) {
                showToast('Nomor VA harus diisi', 'error');
                return;
            }

            for (let i = 0; i < jumlah; i++) {
                cards.push({
                    id: Date.now() + Math.random() + i,
                    nama: nama,
                    va: va
                });
            }

            // Reset field nama (VA biasanya tetap)
            namaInput.value = '';
            namaInput.focus();
            
            renderCards();
            showToast(`${jumlah} Slip Berhasil Ditambahkan`);
        }

        // Logic Hapus Satu
        function deleteCard(id) {
            cards = cards.filter(c => c.id !== id);
            renderCards();
        }

        // Logic Reset
        function clearAll() {
            if (cards.length === 0) return;
            
            if (confirm('Yakin ingin menghapus semua slip?')) {
                cards = [];
                renderCards();
                showToast('Semua data dihapus', 'error');
            }
        }
    </script>
</body>
</html>